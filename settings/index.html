<!doctype html>
<html>

<head>

    <!-- The '/homey.js' script must be included in your settings view to work -->
    <script type="text/javascript" src="/homey.js" data-origin="settings"></script>

</head>

<body>

    <h1 data-i18n="settings.title">
        <!--
            This field will automatically be filled by a translated string with key 'settings.title'.
            Read more about translations at Internationalization.
            -->
    </h1>
    <p data-i18n="settings.subtitle">
        <!--
            This field will also be translated
            -->
    </p>

    <fieldset>
        <legend>These parameters need to be generated by your LightwaveRF App or web page</legend>

        <div class="field row">
            <label for="bearerid">Bearer Token</label>
            <input id="bearerid" type="text" value="" />
        </div>
        <div class="field row">
            <label for="refreshtoken">Refresh Token</label>
            <input id="refreshtoken" type="text" value="" />
        </div>
        <p data-i18n="settings.unsupportedDescription">
            <!--
                    This field will also be translated
                    -->
        </p>
        <div class="field row">
            <textarea id="unsupportedDevices"></textarea>
        </div>
    </fieldset>


    <button id="save" class="right">Save changes</button>

    <script type="text/javascript">
        // a method named 'onHomeyReady' must be present in your code
        function onHomeyReady( Homey )
        {

            // Tell Homey we're ready to be displayed
            Homey.ready();

            var beareridElement = document.getElementById( 'bearerid' );
            var refreshtokenElement = document.getElementById( 'refreshtoken' );
            var unsupportedDevicesElement = document.getElementById( 'unsupportedDevices' );

            var saveElement = document.getElementById( 'save' );

            Homey.get( 'bearerid', function( err, bearerid )
            {
                if ( err ) return Homey.alert( err );
                beareridElement.value = bearerid;
            } );

            Homey.get( 'refreshtoken', function( err, refreshtoken )
            {
                if ( err ) return Homey.alert( err );
                refreshtokenElement.value = refreshtoken;
            } );

            Homey.get( 'unsupportedDevices', function( err, unsupportedDevices )
            {
                if ( err ) return Homey.alert( err );
                unsupportedDevicesElement.value = unsupportedDevices;
                unsupportedDevicesElement.setAttribute( 'cols', unsupportedDevicesElement.parentElement.clientWidth / 8 );
                unsupportedDevicesElement.style.height = ( unsupportedDevicesElement.scrollHeight ) + 'px';
            } );

            saveElement.addEventListener( 'click', function( e )
            {

                Homey.set( 'bearerid', beareridElement.value, function( err )
                {
                    if ( err ) return Homey.alert( err );
                } );
                Homey.set( 'refreshtoken', refreshtokenElement.value, function( err )
                {
                    if ( err ) return Homey.alert( err );
                } );
                Homey.set( 'unsupportedDevices', unsupportedDevicesElement.value, function( err )
                {
                    if ( err ) return Homey.alert( err );
                } );
            } );
        }
    </script>

</body>

</html>